<!DOCTYPE html>
<html>
<head>
    <title>Building Height Estimation PoC - Test Area</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #map { width: 100%; height: 100vh; }
        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 300px;
        }
        .info-panel h3 { margin: 0 0 10px 0; color: #4fc3f7; }
        .info-panel p { margin: 5px 0; font-size: 13px; }
        .stat { color: #81c784; }
        .legend { margin-top: 10px; }
        .legend-item { display: flex; align-items: center; margin: 3px 0; font-size: 12px; }
        .legend-circle { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="info-panel">
        <h3>Height Estimation PoC</h3>
        <p>Test Area: 50m radius</p>
        <p>Images analyzed: <span class="stat">26</span></p>
        <p>Height estimates: <span class="stat">7</span></p>
        <p>Mean height: <span class="stat">64.3m</span></p>
        <p>Median height: <span class="stat">56.1m</span></p>
        <div class="legend">
            <p><b>Estimated Height:</b></p>
            <div class="legend-item"><div class="legend-circle" style="background:#2ecc71"></div> &lt;10m (low-rise)</div>
            <div class="legend-item"><div class="legend-circle" style="background:#f39c12"></div> 10-30m (mid-rise)</div>
            <div class="legend-item"><div class="legend-circle" style="background:#e74c3c"></div> &gt;30m (high-rise)</div>
        </div>
        <p style="margin-top:15px;font-size:11px;color:#888">
            Note: Heights are relative estimates from depth maps.
            Accuracy depends on calibration with known references.
        </p>
    </div>

    <script>
        const map = L.map('map').setView([25.2421, 55.3048], 18);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 20
        }).addTo(map);

        // Test area circle
        L.circle([25.242071, 55.304779], {
            radius: 50,
            color: '#4fc3f7',
            fillOpacity: 0.1,
            weight: 2
        }).addTo(map);

        // Height estimates
        const estimates = [{"image_id": "7879044885485323", "lat": 25.24196419544953, "lon": 55.30462861061096, "direction": 270.0, "height": 102.27745737196952, "distance": 225.7311586604155, "confidence": 0.12150242924690247}, {"image_id": "1887044698480385", "lat": 25.24245426629554, "lon": 55.30490219593048, "direction": 315.0, "height": 73.04167601716887, "distance": 248.07441314455414, "confidence": 0.10155242681503296}, {"image_id": "827604215891753", "lat": 25.242070943722936, "lon": 55.30477881431579, "direction": 315.0, "height": 27.562811939174882, "distance": 248.5422091590647, "confidence": 0.10117307305335999}, {"image_id": "7348605581915380", "lat": 25.242046682759963, "lon": 55.30476272106171, "direction": 315.0, "height": 56.11087994447862, "distance": 249.87309538260212, "confidence": 0.10010157525539398}, {"image_id": "2593291010851326", "lat": 25.242352370539805, "lon": 55.3048700094223, "direction": 180.0, "height": 112.22773440006458, "distance": 245.02070147806612, "confidence": 0.10406439006328583}, {"image_id": "754303840231858", "lat": 25.241954491056376, "lon": 55.304532051086426, "direction": 270.0, "height": 52.86162557523724, "distance": 249.69872488672374, "confidence": 0.10024131089448929}, {"image_id": "300895386398224", "lat": 25.242425153231196, "lon": 55.30489146709442, "direction": 270.0, "height": 26.138368005758235, "distance": 244.83562477235301, "confidence": 0.10421864688396454}];

        estimates.forEach(est => {
            const color = est.height < 10 ? '#2ecc71' :
                         est.height < 30 ? '#f39c12' : '#e74c3c';

            // Draw line showing direction and estimated building
            const dirRad = est.direction * Math.PI / 180;
            const dist = Math.min(est.distance, 30) / 111000; // Convert to degrees

            const endLat = est.lat + dist * Math.cos(dirRad);
            const endLon = est.lon + dist * Math.sin(dirRad) / Math.cos(est.lat * Math.PI / 180);

            L.polyline([[est.lat, est.lon], [endLat, endLon]], {
                color: color,
                weight: 3,
                opacity: 0.7
            }).bindPopup(`
                <b>Height estimate: ${est.height.toFixed(1)}m</b><br>
                Direction: ${est.direction}Â°<br>
                Distance: ~${est.distance.toFixed(0)}m<br>
                Image: ${est.image_id}
            `).addTo(map);
        });

        // Camera positions
        const images = [{"id":417883751137797,"lat":25.2423087009,"lon":55.3048592806,"distance_m":27.6483931605},{"id":422678950546317,"lat":25.2422698834,"lon":55.3048485518,"distance_m":23.2064371626},{"id":1037316951337214,"lat":25.2421049091,"lon":55.304800272,"distance_m":4.3499030574},{"id":7879044885485323,"lat":25.2419641954,"lon":55.3046286106,"distance_m":19.2124512243},{"id":1887044698480385,"lat":25.2424542663,"lon":55.3049021959,"distance_m":44.3932161968},{"id":469408758768081,"lat":25.2420078652,"lon":55.3044033051,"distance_m":38.4135300375},{"id":1908565949595844,"lat":25.242027274,"lon":55.304338932,"distance_m":44.5078999646},{"id":851241033496883,"lat":25.2422262138,"lon":55.3048378229,"distance_m":18.2568323026},{"id":1863705667407825,"lat":25.2419738998,"lon":55.3044569492,"distance_m":34.1234654091},{"id":374107611700533,"lat":25.242391188,"lon":55.3048807383,"distance_m":37.055725997},{"id":3719759198295136,"lat":25.2419544911,"lon":55.3045749664,"distance_m":24.2492802806},{"id":1831263430714163,"lat":25.2420369784,"lon":55.3043067455,"distance_m":47.6294272695},{"id":827604215891753,"lat":25.2420709437,"lon":55.3047788143,"distance_m":0.0},{"id":1122173849067926,"lat":25.2424979359,"lon":55.3049182892,"distance_m":49.5083261456},{"id":7348605581915380,"lat":25.2420466828,"lon":55.3047627211,"distance_m":3.146027119},{"id":1624362778316694,"lat":25.2419690476,"lon":55.3044998646,"distance_m":30.2575296414},{"id":2593291010851326,"lat":25.2423523705,"lon":55.3048700094,"distance_m":32.6097368164},{"id":827567645943799,"lat":25.2420175696,"lon":55.3043711185,"distance_m":41.4322596541},{"id":252079437951395,"lat":25.2420224218,"lon":55.3047412634,"distance_m":6.5859159106},{"id":754303840231858,"lat":25.2419544911,"lon":55.3045320511,"distance_m":27.9937252818},{"id":300895386398224,"lat":25.2424251532,"lon":55.3048914671,"distance_m":40.9836122674},{"id":3001571989979734,"lat":25.2419738998,"lon":55.3046607971,"distance_m":16.0416584863},{"id":458681576723228,"lat":25.242003013,"lon":55.3047198057,"distance_m":9.6062240778},{"id":411174265059870,"lat":25.2421437266,"lon":55.3048163652,"distance_m":8.9309593354},{"id":810034087757016,"lat":25.2421825441,"lon":55.3048270941,"distance_m":13.3256277961},{"id":947866373745829,"lat":25.2419836042,"lon":55.3046929836,"distance_m":12.9938279862}];
        images.forEach(img => {
            L.circleMarker([img.lat, img.lon], {
                radius: 4,
                color: '#fff',
                fillColor: '#4fc3f7',
                fillOpacity: 1,
                weight: 1
            }).addTo(map);
        });
    </script>
</body>
</html>